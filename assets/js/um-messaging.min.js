"object"!=typeof window.UM&&(window.UM={});var UM_Conv_Ajax=!(window.UM.messaging={sending:!1});function um_Hide_Emobox(){var e=jQuery("span.um-message-emolist");e.is(":visible")&&e.hide()}function um_Chatbox(e){var t=e.val().length,s=e.attr("data-maxchar"),o=s-t;jQuery(".um-message-limit:visible").html(o),""!=e.val()?(jQuery(".um-message-send:visible").removeClass("disabled"),window.UM.messaging.sending=!1):jQuery(".um-message-send:visible").addClass("disabled"),s<t?(jQuery(".um-message-limit:visible").addClass("exceed"),jQuery(".um-message-send:visible").addClass("disabled")):(jQuery(".um-message-limit:visible").removeClass("exceed"),""!=e.val()&&(jQuery(".um-message-send:visible").removeClass("disabled"),window.UM.messaging.sending=!1))}jQuery(document.body).on("click",".um-login #um-submit-btn",function(){document.cookie="um_messaging_invite_login=; expires=Thu, 01 Jan 1970 00:00:01 GMT;"});var um_conversations_loaded=!1;function um_messaging_init_conversations_list(){var e,t=jQuery(".um-message-conv");t.length&&(0<jQuery(".um-profile-nav-item.um-profile-nav-messages.active").length&&(void 0!==um_messages_get_url_vars().conversation_id?(e=um_messages_get_url_vars().conversation_id,jQuery(".um-message-conv-item[data-conversation_id="+e+"]")):jQuery(".um-message-conv-item[data-conversation_id]").first()).trigger("click"),t.each(function(){jQuery(this).css({"max-height":"500px"});var e=new SimpleBar(this);e.recalculate(),e.getScrollElement().addEventListener("scroll",function(){var o,e,t,s={allow:!0,reallow:function(){s.allow=!0},delay:400},a=jQuery(this).parents("[data-simplebar]"),n=a.find(".um-message-conv-load-more");!um_conversations_loaded&&s.allow&&(s.allow=!1,n.length)&&(setTimeout(s.reallow,s.delay),o=jQuery(this),(t=jQuery(this).offset().top-n.offset().top-jQuery(this).scrollTop())<wp.hooks.applyFilters("um_messaging_conversations_scroll_max_offset",200))&&(e=a.data("user"),t=a.find(".um-message-conv-item").length,a=window.location.href,um_conversations_loaded=!0,n.show(),wp.ajax.send("um_conversations_load",{data:{user_id:e,offset:t,url:a,nonce:um_scripts.nonce},success:function(e){var t,s;0<e.length?(s=wp.template("um_messages_convesations"),t=n.detach(),s=s({conversations:e}),o.append(s).append(t)):n.remove(),um_conversations_loaded=!1},error:function(e){console.log(e),um_conversations_loaded=!1}}))})}))}function UM_Refresh_Conv(){var e,t,s,o,a=jQuery(".um-message-ajax");a.length&&a.is(":visible")&&!UM_Conv_Ajax&&(e=a.data("message_from"),t=a.data("message_to"),s=a.data("conversation_id"),o=a.data("last_updated"),"new"===s||UM_Refresh_Conv.state&&"run"===UM_Refresh_Conv.state||wp.ajax.send("um_messaging_update",{data:{user_id:e,message_to:t,conversation_id:s,last_updated:o,nonce:um_scripts.nonce},success:function(e){e&&(UM_Update_UTC_to_LocalTime(),0==a.find('.um-message-item[data-message_id="'+e.message_id+'"]').length)&&"nothing_new"!==e.response&&(jQuery(".um-message-ajax").append(e.response),jQuery(".um-popup-autogrow")[0].SimpleBar.getScrollElement().scrollTo(0,jQuery(".um-popup-autogrow").find(".simplebar-content").outerHeight()+jQuery(".um-popup-autogrow")[0].scrollHeight),a.data("last_updated",e.last_updated))},error:function(e){console.log(e)},beforeSend:function(e){UM_Refresh_Conv.state="run"},complete:function(e){UM_Refresh_Conv.state="ready"}}))}function UM_Update_UTC_to_LocalTime(){void 0!==moment.tz&&jQuery(".um-message-item-time").each(function(){var e=jQuery(this).attr("title"),t=jQuery(this).data("um-message-utc-time");""!==e&&void 0!==e||void 0===t||""===t||(e=moment.tz(t,moment.tz.guess()).format("LLLL"),jQuery(this).attr("title",e))})}function um_messages_get_url_vars(){for(var e,t=[],s=window.location.href.slice(window.location.href.indexOf("?")+1).split("&"),o=0;o<s.length;o++)e=s[o].split("="),t.push(e[0]),t[e[0]]=e[1];return t}function um_getCaret(e){var t,s;return e.selectionStart||(!document.selection||(e.trigger("focus"),null==(t=document.selection.createRange()))?0:(s=(e=e.createTextRange()).duplicate(),e.moveToBookmark(t.getBookmark()),s.setEndPoint("EndToStart",e),s.text.length))}function um_getPosInRow(e){var t=um_getCaret(e);return e.value.substr(0,t).replace(/^(.*[\n\r])*([^\n\r]*)$/,"$2").length}function um_setCaretPosition(e,t){e.setSelectionRange(t,t),e.umCaretPosition={start:t,end:t},jQuery(e).trigger("focus")}function um_getCaretPosition(e){if("selectionStart"in e&&document.activeElement===e)return{start:e.selectionStart,end:e.selectionEnd};if(e.createTextRange){var t=document.selection.createRange();if(t.parentElement()===e){var s=e.createTextRange();s.moveToBookmark(t.getBookmark());for(var o=0;0<s.compareEndPoints("EndToStart",s);s.moveEnd("character",-1))o++;s.setEndPoint("StartToStart",e.createTextRange());for(var a={start:0,end:o};0<s.compareEndPoints("EndToStart",s);s.moveEnd("character",-1))a.start++,a.end++;return a}}return-1}jQuery(document).ready(function(){jQuery(document.body).on("touchstart",".um-message-item",function(e){e=jQuery(e.currentTarget);e.find(".um-message-item-show-on-hover").toggle(),e.siblings().find(".um-message-item-show-on-hover").hide()}),jQuery(document.body).on("click",".um-message-unblock",function(e){e.preventDefault();e=jQuery(this).attr("data-user_id");return jQuery(this).parents(".um-message-blocked").fadeOut("fast"),wp.ajax.send("um_messaging_unblock_user",{data:{user_id:e,nonce:um_scripts.nonce},success:function(e){UM_Update_UTC_to_LocalTime()},error:function(e){console.log(e)}}),!1}),jQuery(document.body).on("click",".um-message-blocku:not(.um-message-blocked-true)",function(e){e.preventDefault();var t,e=jQuery(this).attr("data-confirm_text");return confirm(e)&&(jQuery(this).addClass("um-message-blocked-true"),e=jQuery(this).attr("data-conversation_id"),t=jQuery(this).attr("data-other_user"),UM.common.tipsy.hide(),jQuery(".um-message-body,.um-message-footer,.um-message-header-left").css({opacity:.5}),jQuery('.um-message-conv-item[data-conversation_id="'+e+'"]').remove(),jQuery(".um-message-footer").empty(),jQuery(".um-message-item-remove").remove(),jQuery("a.um-message-delconv").addClass("disabled"),wp.ajax.send("um_messaging_block_user",{data:{other_user:t,nonce:um_scripts.nonce},success:function(e){},error:function(e){console.log(e)}})),!1}),jQuery(document.body).on("click",".um-message-delconv.disabled",function(e){return e.preventDefault(),!1}),jQuery(document.body).on("click",".um-message-delconv",function(e){e.preventDefault();var e=jQuery(this).attr("data-conversation_id"),t=jQuery(this).attr("data-other_user");return UM.common.tipsy.hide(),jQuery(".um-message-conv-view").length?(jQuery(".um-message-conv-item[data-conversation_id="+e+"]").remove(),jQuery(".um-message-conv-item").length&&jQuery(".um-message-conv-view").is(":visible")&&jQuery(".um-message-conv-item:first").trigger("click"),jQuery(".um-message-conv-view").empty()):remove_Modal(),0==jQuery(".um-message-conv").find(".um-message-conv-item").length&&(jQuery(".um-profile-body.messages").append('<div class="um-message-noconv"><i class="um-icon-android-chat"></i>'+wp.i18n.__("No chats found here","um-messaging")+"</div>"),jQuery(".um-profile-body.messages").find(".um-message-conv, .um-message-conv-view").hide()),wp.ajax.send("um_messaging_delete_conversation",{data:{conversation_id:e,other_user:t,nonce:um_scripts.nonce},success:function(e){},error:function(e){console.log(e)}}),!1}),jQuery(document.body).on("click",".um-message-hide",function(e){return e.preventDefault(),remove_Modal(),!1}),jQuery(document.body).on("click",".um-login-to-msg-btn",function(e){e.preventDefault();var t,s,e=jQuery(e.currentTarget).css({cursor:"wait"}),o=jQuery("#um_messaging_hidden_login .um-modal"),a=e.attr("data-message_to");if(o.length)return jQuery("body").hasClass("um-page-members")&&((s=document.body.className.match(/(^|\s)page-id-(\d+)(\s|$)/))&&(t=s[2]),s=jQuery(".um-members-pagi .current").text()),wp.ajax.send("um_messaging_login_modal",{data:{message_to:a,page_id:t,current_page:s,nonce:um_scripts.nonce},success:function(e){"string"==typeof e.content&&(o.find(".um-message-header").remove(),o.find(".um-message-modal").prepend(e.content),o.find(".um-message-hide").show(),o.siblings(".um-modal-overlay").remove(),o.removeClass("um-modal-hidden").show().after('<div class="um-modal-overlay"></div>')),"string"==typeof e.redirect_url&&o.find("#redirect_to").val(e.redirect_url),o.find(".g-recaptcha:not(:empty)").length&&"object"==typeof grecaptcha&&grecaptcha.reset(),"function"==typeof um_modal_responsive?um_modal_responsive():"function"==typeof responsive_Modal&&responsive_Modal(),setTimeout(function(){jQuery(document.body).trigger("resize")},200),jQuery(document).trigger("um_messaging_open_login_form")},error:function(e){console.log(e)}}),!1;window.location.assign(e.attr("href"))}),jQuery("#um_messaging_hidden_login").on("click",".um-modal-overlay, .um-message-hide",function(e){e.stopPropagation(),jQuery(e.delegateTarget).find(".um-modal").addClass("um-modal-hidden").hide().siblings(".um-modal-overlay").remove(),jQuery(".um-login-to-msg-btn").css({cursor:"pointer"}),jQuery(document).trigger("um_messaging_close_login_form")}),jQuery(document.body).on("click",".um-message-conv-item",function(e){var s,o;return e.preventDefault(),jQuery(this).attr("data-trigger_modal")&&jQuery(".um-message-conv-view").is(":hidden")||jQuery(this).hasClass("active")||UM_Conv_Ajax||(UM_Conv_Ajax=!0,s=jQuery(this),o=jQuery(this).html(),jQuery(this).find("img").replaceWith('<span class="um-message-cssload"><i class="um-faicon-circle-o-notch"></i></span>'),e=jQuery(this).attr("data-message_to"),window.history.pushState("string","Conversation",jQuery(this).attr("href")),wp.ajax.send("um_messaging_start",{data:{message_to:e,nonce:um_scripts.nonce},success:function(e){var t;e&&(UM_Update_UTC_to_LocalTime(),s.html(o).addClass("active").siblings(".um-message-conv-item").removeClass("active"),1===(t=(e=jQuery(".um-message-conv-view").html(e)).find("textarea.um_message_text")).length&&"function"==typeof autosize&&autosize(t),(t=e.find(".um-message-autoheight")).length&&t.each(function(){jQuery(this).css({"max-height":"500px"}),new SimpleBar(this).recalculate()}),UM.common.tipsy.init(),UM_Conv_Ajax=!1,setTimeout(function(){jQuery(".um-popup-autogrow:visible").length&&jQuery(".um-popup-autogrow:visible")[0].SimpleBar.getScrollElement().scrollTo(0,jQuery(".um-popup-autogrow:visible").find(".simplebar-content").outerHeight()+jQuery(".um-popup-autogrow:visible")[0].scrollHeight)},1e3))},error:function(e){console.log(e)}})),!1}),jQuery(document.body).on("click touchend",".um-message-item-remove",function(e){e.preventDefault();var e=jQuery(e.target),t=e.parents(".um-message-item").attr("data-message_id"),s=e.parents(".um-message-item").attr("data-conversation_id");return UM.common.tipsy.hide(),e.parents(".um-message-item").fadeOut("fast"),wp.ajax.send("um_messaging_remove",{data:{message_id:t,conversation_id:s,nonce:um_scripts.nonce},success:function(e){e&&e.count_messages<1&&jQuery(".um-message-header-right .um-gdpr-donwload-link").hide()},error:function(e){console.log(e)}}),!1}),jQuery(document.body).on("click",".um-message-emo",function(){jQuery("span.um-message-emolist").is(":visible")?um_Hide_Emobox():jQuery("span.um-message-emolist").show()}),jQuery(document.body).on("click",".um-message-emolist span.um-message-insert-emo",function(e){var t=jQuery(this).attr("data-emo"),e=jQuery(e.target).closest(".um-message-footer").find("textarea.um_message_text"),s=e.prop("umCaretPosition")?e.prop("umCaretPosition").end:0,o=e.val().substr(0,s),s=e.val().substr(s,e.val().length),a=(o+" "+t+" ").length;e.val(o+" "+t+" "+s),um_setCaretPosition(e.get(0),a),um_Hide_Emobox(),um_Chatbox(e),e.trigger("focus")}),jQuery(document.body).on("click",'.um-message-btn:not(.um-login-to-msg-btn), *[data-trigger_modal="conversation"]',function(e){return e.preventDefault(),jQuery(this).attr("data-trigger_modal")&&jQuery(".um-message-conv-view").is(":visible")||(e=jQuery(this).attr("data-message_to"),jQuery(".um-message-conv-item").removeClass("active"),jQuery(this).addClass("active"),prepare_Modal(),wp.ajax.send("um_messaging_start",{data:{message_to:e,nonce:um_scripts.nonce},success:function(e){e?(show_Modal(e),responsive_Modal(),UM.common.tipsy.init(),setTimeout(function(){jQuery(".um-popup-autogrow:visible").length&&jQuery(".um-popup-autogrow:visible")[0].SimpleBar.getScrollElement().scrollTo(0,jQuery(".um-popup-autogrow:visible").find(".simplebar-content").outerHeight()+jQuery(".um-popup-autogrow:visible")[0].scrollHeight)},1e3)):remove_Modal()},error:function(e){console.log(e)}})),!1}),jQuery(document.body).on("click",".um-message-send",function(){if(!1===window.UM.messaging.sending){window.UM.messaging.sending=!0;var e,s=jQuery(this);let t=s.parents(".um-message-footer").find(".um_message_text:visible");if(!jQuery(this).hasClass("disabled"))return s.addClass("disabled"),s=s.parents(".um-message-footer").siblings(".um-message-body").data("message_to"),e=t.val(),wp.ajax.send("um_messaging_send",{data:{message_to:s,content:e,nonce:um_scripts.nonce},success:function(e){UM_Update_UTC_to_LocalTime(),t.val(""),t.get(0).dispatchEvent(new Event("autosize.update")),jQuery(".um-message-body:visible").find(".um-message-ajax:visible").html(e.messages).data("last_updated",e.last_updated),(jQuery('[data-conversation_id="'+e.conversation_id+'"]:not(.um-message-item)').length?jQuery('[data-conversation_id="'+e.conversation_id+'"]:not(.um-message-item)'):jQuery('[data-conversation_id="new"]').data("conversation_id",e.conversation_id)).show(),jQuery(".um-gdpr-donwload-link:visible").attr("href",e.chat_history_download),e.limit_hit&&jQuery(".um-message-footer:visible").html(jQuery(".um-message-footer:visible").data("limit_hit")),jQuery(".um-message-footer:visible").find(".um-message-limit").html(t.data("maxchar")),jQuery(".um-popup-autogrow:visible")[0].SimpleBar.getScrollElement().scrollTo(0,jQuery(".um-popup-autogrow:visible").find(".simplebar-content").outerHeight()+jQuery(".um-popup-autogrow:visible")[0].scrollHeight),um_Chatbox(t),window.UM.messaging.sending=!1},error:function(e){t.val(""),um_Chatbox(t),window.UM.messaging.sending=!1,console.log(e)}}),!1}}),jQuery(document.body).on("click","textarea.um_message_text",function(e){um_Hide_Emobox()}),jQuery(document.body).on("keyup keydown keypress","textarea.um_message_text",function(e){um_Hide_Emobox(),um_Chatbox(jQuery(this))}).on("click touchend keyup","textarea.um_message_text",function(e){e.target.umCaretPosition=um_getCaretPosition(e.target)}),jQuery(document.body).on("keypress","textarea.um_message_text",function(e){(e.keyCode&&13===e.keyCode||13===e.which)&&(!0===e.ctrlKey||!0===e.shiftKey?(e.preventDefault(),e.target.value=e.target.value+"\n"):!1!==window.UM.messaging.sending?e.preventDefault():(e.preventDefault(),jQuery(e.target).closest(".um-message-footer").find(".um-message-send:visible:not(.disabled)").trigger("click")))}),jQuery(document.body).on("paste","textarea.um_message_text",function(e){var t=jQuery(this),e=e.originalEvent.clipboardData.getData("text"),s=(um_Hide_Emobox(),t.val().length+e.length),o=t.attr("data-maxchar"),a=o-s;jQuery(".um-message-limit:visible").html(a),t.val()+e!=""?jQuery(".um-message-send:visible").removeClass("disabled"):jQuery(".um-message-send:visible").addClass("disabled"),o<s?(jQuery(".um-message-limit:visible").addClass("exceed"),jQuery(".um-message-send:visible").addClass("disabled")):(jQuery(".um-message-limit:visible").removeClass("exceed"),t.val()+e!=""&&jQuery(".um-message-send:visible").removeClass("disabled"))}),jQuery(document).on("click","#um_messaging_hidden_login .um-modal a",function(e){jQuery("#um_messaging_hidden_login .um-modal a").unbind("click");var t=jQuery(this).attr("href");window.location.replace(t)}),setTimeout(function(){jQuery("body.um-page-user .um-popup-autogrow:visible").length&&jQuery("body.um-page-user .um-popup-autogrow:visible")[0].SimpleBar.getScrollElement().scrollTo(0,jQuery(".um-popup-autogrow:visible").find(".simplebar-content").outerHeight()+jQuery(".um-popup-autogrow:visible")[0].scrollHeight)},1e3),um_messages.can_read&&setInterval(UM_Refresh_Conv,um_messages.interval),um_messaging_init_conversations_list(),UM_Update_UTC_to_LocalTime()});